{
  "version": "3.0.0",
  "generated_at": "2025-01-08T00:00:00Z",
  "description": "CRM Module - Complete UI to Supabase wiring",
  "status": "âœ… BLOQUE 2 COMPLETE",
  "crm_module": {
    "accounts": {
      "table": "public.accounts",
      "hooks": "src/hooks/crm/useAccounts.ts",
      "fields": ["name", "account_type", "industry", "email", "phone", "tax_id", "notes"],
      "relations": ["sucursal_id -> sucursales"],
      "operations": ["list", "create", "update", "delete"],
      "search": "name, email, phone",
      "pagination": "client-side"
    },
    "contacts": {
      "table": "public.contacts",
      "hooks": "src/hooks/crm/useContacts.ts",
      "fields": ["first_name", "last_name", "job_title", "email", "phone", "mobile"],
      "relations": ["account_id -> accounts"],
      "operations": ["list", "create", "update", "delete"],
      "search": "first_name, last_name, email"
    },
    "opportunities": {
      "table": "public.opportunities",
      "hooks": "src/hooks/crm/useOpportunities.ts",
      "fields": ["folio", "name", "stage", "amount", "probability", "expected_close_date"],
      "relations": ["account_id -> accounts (required)", "contact_id -> contacts (optional)"],
      "operations": ["list", "create", "update", "delete"],
      "units_link": "opportunity_units table (many-to-many)",
      "folio_generation": "Auto via trigger: OPP-YYYYMM-XXX",
      "search": "name, folio"
    },
    "tasks": {
      "table": "public.tasks",
      "hooks": "src/hooks/crm/useTasks.ts",
      "fields": ["subject", "description", "due_date", "priority", "status", "assigned_to"],
      "relations": ["related_to_type + related_to_id (polymorphic)"],
      "operations": ["list", "create", "update", "delete"],
      "soft_complete": "completed_at set on status=completada"
    },
    "units": {
      "table": "public.units",
      "hooks": "src/hooks/crm/useUnits.ts",
      "fields": ["unit_number", "unit_type", "area_m2", "price", "status"],
      "relations": ["project_id -> projects (optional)"],
      "operations": ["list", "create", "update", "delete"]
    },
    "attachments": {
      "table": "public.crm_attachments",
      "hooks": "src/hooks/crm/useCrmAttachments.ts",
      "bucket": "crm-attachments (private)",
      "path_pattern": "entityId/YYMM-uuid-filename.ext",
      "read_mode": "signed URL (600s)",
      "operations": ["upload", "download", "delete"],
      "helpers": ["uploadToBucket", "getSignedUrl", "deleteFromBucket"]
    },
    "activities": {
      "table": "public.crm_activities",
      "hooks": "src/hooks/crm/useCrmActivities.ts",
      "auto_log": "Triggers on accounts, contacts, opportunities, tasks, leads",
      "operations": ["view only"]
    }
  },
  "storage": {
    "bucket": "crm-attachments",
    "privacy": "private",
    "rls": "module permission: crm",
    "conventions": {
      "path": "entityId/YYMM-uuid-filename.ext",
      "storage_column": "file_url (relative path only)",
      "access": "createSignedUrl() with 600s expiry"
    }
  },
  "rls_policies": {
    "pattern": "Same as leads: admin all, module permissions for CRM",
    "modules": ["crm"],
    "permissions": ["view", "create", "edit", "delete"]
  },
  "next_steps": [
    "Create UI pages: Accounts, Contacts, Opportunities, Tasks, Units",
    "Create dialogs for CRUD operations",
    "Add routes to sidebar",
    "Test all CRUD flows",
    "Verify RLS permissions"
  ]
}